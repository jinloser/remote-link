<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>参数设置</title>
    <style>
      .config-form {
        font-size: 14px;
        padding: 15px 0px;
        .row {
          margin-bottom: 15px;
          label {
            display: inline-block;
            width: 90px;
            text-align: right;
          }
          input {
            width: calc(100% - 115px);
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
          }
          input.checkbox {
            width: 12px;
          }
        }
        .engineRow {
          input {
            width: calc(100% - 200px);
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
          }
          button {
            width: 80px;
            text-align: center;
            height: 28px;
            line-height: 24px;
            margin: 0 auto;
            cursor: pointer;
          }
        }
        .row1 {
          text-align: right;
          padding-right: 10px;
          position: absolute;
          bottom: 20px;
          right: 10px;
        }
        .submit {
          width: 60px;
          text-align: center;
          height: 30px;
          line-height: 28px;
          margin: 0 auto;
          cursor: pointer;
        }
      }
    </style>
  </head>
  <body>
    <form id="config-form" class="config-form">
      <div class="row">
        <label for="connectIp">远程连接地址:</label>
        <input type="text" id="connectIp" name="connectIp" placeholder="请输入远程连接地址" />
      </div>
      <div class="row">
        <label for="localPort">web访问端口:</label>
        <input type="number" id="localPort" name="localPort" placeholder="请输入web访问端口" />
      </div>
      <div class="row">
        <label for="isStartEngine">是否启动引擎:</label>
        <input type="checkbox" id="isStartEngine" name="isStartEngine" class="checkbox" />
      </div>
      <div class="row engineRow" id="enginePathRow">
        <label for="enginePath">引擎启动程序:</label>
        <input type="text" id="enginePath" name="enginePath" readonly placeholder="请选择引擎启动程序" />
        <button type="button" id="engineBtn">选择引擎</button>
      </div>
      <div class="row1">
        <button type="submit" class="submit">保存</button>
      </div>
    </form>

    <script>
      const { ipcRenderer } = require("electron")

      const isStartEngineCheckbox = document.getElementById("isStartEngine")
      const enginePathInput = document.getElementById("enginePath")
      const engineBtn = document.getElementById("engineBtn")
      const enginePathRow = document.getElementById("enginePathRow")
      document.getElementById("config-form").addEventListener("submit", () => {
        event.preventDefault()
        const newConfig = {
          enginePath: enginePathInput.value,
          isStartEngine: document.getElementById("isStartEngine").checked,
          remoteServer: {
            localPort: parseInt(document.getElementById("localPort").value, 10),
            connectIp: document.getElementById("connectIp").value
          }
        }
        ipcRenderer.send("save-config", newConfig) // 发送保存配置的请求
      })

      ipcRenderer.on("config-loaded", (event, config) => {
        console.log("config-loaded", config)
        const { isStartEngine = false, enginePath, remoteServer = {} } = config
        const { localPort = "", connectIp = "" } = remoteServer
        document.getElementById("isStartEngine").checked = isStartEngine
        enginePathInput.value = enginePath
        document.getElementById("localPort").value = localPort
        document.getElementById("connectIp").value = connectIp
        enginePathRow.style.display = isStartEngine ? "block" : "none"
      })

      isStartEngineCheckbox.addEventListener("change", () => {
        if (isStartEngineCheckbox.checked) {
          enginePathRow.style.display = "block"
        } else {
          enginePathRow.style.display = "none"
        }
      })

      engineBtn.addEventListener("click", async () => {
        const selectedFilePath = await ipcRenderer.invoke("dialog:open")
        if (selectedFilePath) enginePathInput.value = selectedFilePath
      })

      ipcRenderer.send("load-config") // 请求加载当前配置
    </script>
  </body>
</html>
